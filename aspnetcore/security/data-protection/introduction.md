---
title: Proteção de dados do ASP.NET Core
author: rick-anderson
description: Saiba mais sobre o conceito de proteção de dados e os princípios de design do ASP.NET Core APIs de proteção de dados.
ms.author: riande
ms.custom: mvc
ms.date: 10/24/2018
uid: security/data-protection/introduction
ms.openlocfilehash: 37f170a3e8a46ef2215b0999358d46dd402636df
ms.sourcegitcommit: 9a129f5f3e31cc449742b164d5004894bfca90aa
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78664440"
---
# <a name="aspnet-core-data-protection"></a><span data-ttu-id="3374e-103">Proteção de dados do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="3374e-103">ASP.NET Core Data Protection</span></span>

<span data-ttu-id="3374e-104">Os aplicativos Web geralmente precisam armazenar dados sensíveis à segurança.</span><span class="sxs-lookup"><span data-stu-id="3374e-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="3374e-105">O Windows fornece DPAPI para aplicativos de área de trabalho, mas isso não é adequado para aplicativos Web.</span><span class="sxs-lookup"><span data-stu-id="3374e-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="3374e-106">A ASP.NET Core pilha de proteção de dados fornece uma API criptográfica simples e fácil de usar que um desenvolvedor pode usar para proteger dados, incluindo o gerenciamento e a rotação de chaves.</span><span class="sxs-lookup"><span data-stu-id="3374e-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="3374e-107">O ASP.NET Core pilha de proteção de dados foi projetado para servir como a substituição de longo prazo para o elemento de&gt; &lt;machineKey no ASP.NET 1. x-4. x.</span><span class="sxs-lookup"><span data-stu-id="3374e-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the &lt;machineKey&gt; element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="3374e-108">Ele foi projetado para resolver muitas das deficiências da pilha criptográfica antiga, fornecendo uma solução pronta para uso para a maioria dos casos de utilização que os aplicativos modernos provavelmente encontrarão.</span><span class="sxs-lookup"><span data-stu-id="3374e-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="3374e-109">Declaração do problema</span><span class="sxs-lookup"><span data-stu-id="3374e-109">Problem statement</span></span>

<span data-ttu-id="3374e-110">A declaração geral do problema pode ser disparada de forma sucinta em uma única frase: preciso manter informações confiáveis para recuperação posterior, mas não confio no mecanismo de persistência.</span><span class="sxs-lookup"><span data-stu-id="3374e-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="3374e-111">Em termos da Web, isso pode ser escrito como "preciso fazer ida e volta em estado confiável por meio de um cliente não confiável".</span><span class="sxs-lookup"><span data-stu-id="3374e-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="3374e-112">O exemplo canônico disso é um cookie de autenticação ou um token de portador.</span><span class="sxs-lookup"><span data-stu-id="3374e-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="3374e-113">O servidor gera um token "Eu sou Groot e tem permissões XYZ" e o passa para o cliente.</span><span class="sxs-lookup"><span data-stu-id="3374e-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="3374e-114">Em alguma data futura, o cliente apresentará esse token de volta ao servidor, mas o servidor precisa de algum tipo de garantia de que o cliente não tenha forjado o token.</span><span class="sxs-lookup"><span data-stu-id="3374e-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="3374e-115">Portanto, o primeiro requisito: autenticidade (também conhecido como</span><span class="sxs-lookup"><span data-stu-id="3374e-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="3374e-116">integridade, prova de adulteração).</span><span class="sxs-lookup"><span data-stu-id="3374e-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="3374e-117">Como o estado persistente é confiável pelo servidor, antecipamos que esse Estado pode conter informações específicas para o ambiente operacional.</span><span class="sxs-lookup"><span data-stu-id="3374e-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="3374e-118">Isso pode estar na forma de um caminho de arquivo, uma permissão, um identificador ou outra referência indireta ou alguma outra parte dos dados específicos do servidor.</span><span class="sxs-lookup"><span data-stu-id="3374e-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="3374e-119">Essas informações geralmente não devem ser divulgadas para um cliente não confiável.</span><span class="sxs-lookup"><span data-stu-id="3374e-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="3374e-120">Portanto, o segundo requisito: confidencialidade.</span><span class="sxs-lookup"><span data-stu-id="3374e-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="3374e-121">Por fim, como os aplicativos modernos são componented, o que vimos é que os componentes individuais desejarão aproveitar esse sistema sem considerar outros componentes do sistema.</span><span class="sxs-lookup"><span data-stu-id="3374e-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="3374e-122">Por exemplo, se um componente de token de portador estiver usando essa pilha, ele deverá operar sem interferência de um mecanismo CSRF que também pode estar usando a mesma pilha.</span><span class="sxs-lookup"><span data-stu-id="3374e-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="3374e-123">Portanto, o requisito final: isolamento.</span><span class="sxs-lookup"><span data-stu-id="3374e-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="3374e-124">Podemos fornecer mais restrições para restringir o escopo de nossos requisitos.</span><span class="sxs-lookup"><span data-stu-id="3374e-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="3374e-125">Supomos que todos os serviços que operam dentro do cryptosystem são igualmente confiáveis e que os dados não precisam ser gerados ou consumidos fora dos serviços sob nosso controle direto.</span><span class="sxs-lookup"><span data-stu-id="3374e-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="3374e-126">Além disso, exigimos que as operações sejam o mais rápido possível, já que cada solicitação para o serviço Web pode passar pelo cryptosystem uma ou mais vezes.</span><span class="sxs-lookup"><span data-stu-id="3374e-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="3374e-127">Isso torna a criptografia simétrica ideal para nosso cenário, e podemos descontar a criptografia assimétrica até o momento em que for necessário.</span><span class="sxs-lookup"><span data-stu-id="3374e-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="3374e-128">Filosofia de design</span><span class="sxs-lookup"><span data-stu-id="3374e-128">Design philosophy</span></span>

<span data-ttu-id="3374e-129">Começamos identificando problemas com a pilha existente.</span><span class="sxs-lookup"><span data-stu-id="3374e-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="3374e-130">Depois que tivemos isso, pesquisamos o panorama das soluções existentes e concluíram que nenhuma solução existente tinha tido os recursos que buscamos.</span><span class="sxs-lookup"><span data-stu-id="3374e-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="3374e-131">Depois, projetamos uma solução com base em vários princípios de orientação.</span><span class="sxs-lookup"><span data-stu-id="3374e-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="3374e-132">O sistema deve oferecer simplicidade de configuração.</span><span class="sxs-lookup"><span data-stu-id="3374e-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="3374e-133">O ideal é que o sistema seja zero de configuração e os desenvolvedores pudessem atingir o solo em execução.</span><span class="sxs-lookup"><span data-stu-id="3374e-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="3374e-134">Em situações em que os desenvolvedores precisam configurar um aspecto específico (como o repositório de chaves), deve-se considerar a consideração para tornar essas configurações específicas simples.</span><span class="sxs-lookup"><span data-stu-id="3374e-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="3374e-135">Ofereça uma API simples voltada para o consumidor.</span><span class="sxs-lookup"><span data-stu-id="3374e-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="3374e-136">As APIs devem ser fáceis de usar corretamente e difíceis de usar incorretamente.</span><span class="sxs-lookup"><span data-stu-id="3374e-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="3374e-137">Os desenvolvedores não devem aprender os principais princípios de gerenciamento.</span><span class="sxs-lookup"><span data-stu-id="3374e-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="3374e-138">O sistema deve lidar com a seleção de algoritmos e o tempo de vida da chave em nome do desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="3374e-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="3374e-139">O ideal é que o desenvolvedor nunca tenha acesso ao material de chave bruto.</span><span class="sxs-lookup"><span data-stu-id="3374e-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="3374e-140">As chaves devem ser protegidas em repouso quando possível.</span><span class="sxs-lookup"><span data-stu-id="3374e-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="3374e-141">O sistema deve descobrir um mecanismo de proteção padrão apropriado e aplicá-lo automaticamente.</span><span class="sxs-lookup"><span data-stu-id="3374e-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="3374e-142">Com esses princípios em mente, desenvolvemos uma pilha de proteção de dados simples e [fácil de usar](xref:security/data-protection/using-data-protection) .</span><span class="sxs-lookup"><span data-stu-id="3374e-142">With these principles in mind we developed a simple, [easy to use](xref:security/data-protection/using-data-protection) data protection stack.</span></span>

<span data-ttu-id="3374e-143">O ASP.NET Core APIs de proteção de dados não se destina principalmente à persistência indefinida de cargas confidenciais.</span><span class="sxs-lookup"><span data-stu-id="3374e-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="3374e-144">Outras tecnologias como o [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) e o [Azure Rights Management](/rights-management/) são mais adequadas para o cenário de armazenamento indefinido e têm recursos de gerenciamento de chaves de alta segurança.</span><span class="sxs-lookup"><span data-stu-id="3374e-144">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="3374e-145">Dito isso, não há nada proibindo um desenvolvedor de usar o ASP.NET Core APIs de proteção de dados para proteção de longo prazo de dados confidenciais.</span><span class="sxs-lookup"><span data-stu-id="3374e-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="3374e-146">Público-alvo</span><span class="sxs-lookup"><span data-stu-id="3374e-146">Audience</span></span>

<span data-ttu-id="3374e-147">O sistema de proteção de dados é dividido em cinco pacotes principais.</span><span class="sxs-lookup"><span data-stu-id="3374e-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="3374e-148">Vários aspectos dessas APIs visam três públicos principais;</span><span class="sxs-lookup"><span data-stu-id="3374e-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="3374e-149">O aplicativo de destino [visão geral das APIs de consumidor](xref:security/data-protection/consumer-apis/overview) e os desenvolvedores de estrutura.</span><span class="sxs-lookup"><span data-stu-id="3374e-149">The [Consumer APIs Overview](xref:security/data-protection/consumer-apis/overview) target application and framework developers.</span></span>

   <span data-ttu-id="3374e-150">"Não quero saber mais sobre como a pilha opera ou sobre como ela está configurada.</span><span class="sxs-lookup"><span data-stu-id="3374e-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="3374e-151">Eu simplesmente quero executar alguma operação da maneira mais simples possível com uma alta probabilidade de usar as APIs com êxito. "</span><span class="sxs-lookup"><span data-stu-id="3374e-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="3374e-152">As [APIs de configuração](xref:security/data-protection/configuration/overview) visam os desenvolvedores de aplicativos e administradores de sistema.</span><span class="sxs-lookup"><span data-stu-id="3374e-152">The [configuration APIs](xref:security/data-protection/configuration/overview) target application developers and system administrators.</span></span>

   <span data-ttu-id="3374e-153">"Preciso dizer ao sistema de proteção de dados que meu ambiente requer caminhos ou configurações não padrão."</span><span class="sxs-lookup"><span data-stu-id="3374e-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="3374e-154">As APIs de extensibilidade visam os desenvolvedores responsáveis pela implementação de uma política personalizada.</span><span class="sxs-lookup"><span data-stu-id="3374e-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="3374e-155">O uso dessas APIs seria limitado a situações raras e a desenvolvedores experientes com reconhecimento de segurança.</span><span class="sxs-lookup"><span data-stu-id="3374e-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="3374e-156">"Preciso substituir um componente inteiro no sistema porque tenho requisitos de comportamento verdadeiramente exclusivos.</span><span class="sxs-lookup"><span data-stu-id="3374e-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="3374e-157">Quero aprender partes de uma superfície de API que são usadas de forma incomum para criar um plug-in que atenda aos meus requisitos. "</span><span class="sxs-lookup"><span data-stu-id="3374e-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="3374e-158">Layout do pacote</span><span class="sxs-lookup"><span data-stu-id="3374e-158">Package layout</span></span>

<span data-ttu-id="3374e-159">A pilha de proteção de dados consiste em cinco pacotes.</span><span class="sxs-lookup"><span data-stu-id="3374e-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="3374e-160">[Microsoft. AspNetCore. dataprotection. abstrações](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) contém as interfaces <xref:Microsoft.AspNetCore.DataProtection.IDataProtectionProvider> e <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> para criar serviços de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="3374e-160">[Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) contains the <xref:Microsoft.AspNetCore.DataProtection.IDataProtectionProvider> and <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> interfaces to create data protection services.</span></span> <span data-ttu-id="3374e-161">Ele também contém métodos de extensão úteis para trabalhar com esses tipos (por exemplo, [IDataProtector. Protect](xref:Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Protect*)).</span><span class="sxs-lookup"><span data-stu-id="3374e-161">It also contains useful extension methods for working with these types (for example, [IDataProtector.Protect](xref:Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Protect*)).</span></span> <span data-ttu-id="3374e-162">Se o sistema de proteção de dados for instanciado em outro lugar e você estiver consumindo a API, `Microsoft.AspNetCore.DataProtection.Abstractions`de referência.</span><span class="sxs-lookup"><span data-stu-id="3374e-162">If the data protection system is instantiated elsewhere and you're consuming the API, reference `Microsoft.AspNetCore.DataProtection.Abstractions`.</span></span>

* <span data-ttu-id="3374e-163">O [Microsoft. AspNetCore.](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection/) dataprotection contém a implementação principal do sistema de proteção de dados, incluindo operações essenciais de criptografia, gerenciamento de chaves, configuração e extensibilidade.</span><span class="sxs-lookup"><span data-stu-id="3374e-163">[Microsoft.AspNetCore.DataProtection](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection/) contains the core implementation of the data protection system, including core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="3374e-164">Para instanciar o sistema de proteção de dados (por exemplo, adicioná-lo a um <xref:Microsoft.Extensions.DependencyInjection.IServiceCollection>) ou modificar ou estender seu comportamento, `Microsoft.AspNetCore.DataProtection`de referência.</span><span class="sxs-lookup"><span data-stu-id="3374e-164">To instantiate the data protection system (for example, adding it to an <xref:Microsoft.Extensions.DependencyInjection.IServiceCollection>) or modifying or extending its behavior, reference `Microsoft.AspNetCore.DataProtection`.</span></span>

* <span data-ttu-id="3374e-165">[Microsoft. AspNetCore. dataprotection. Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contém APIs adicionais que os desenvolvedores podem encontrar úteis, mas que não pertencem ao pacote principal.</span><span class="sxs-lookup"><span data-stu-id="3374e-165">[Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="3374e-166">Por exemplo, esse pacote contém métodos de fábrica para instanciar o sistema de proteção de dados para armazenar chaves em um local no sistema de arquivos sem injeção de dependência (consulte <xref:Microsoft.AspNetCore.DataProtection.DataProtectionProvider>).</span><span class="sxs-lookup"><span data-stu-id="3374e-166">For instance, this package contains factory methods to instantiate the data protection system to store keys at a location on the file system without dependency injection (see <xref:Microsoft.AspNetCore.DataProtection.DataProtectionProvider>).</span></span> <span data-ttu-id="3374e-167">Ele também contém métodos de extensão para limitar o tempo de vida de cargas protegidas (consulte <xref:Microsoft.AspNetCore.DataProtection.ITimeLimitedDataProtector>).</span><span class="sxs-lookup"><span data-stu-id="3374e-167">It also contains extension methods for limiting the lifetime of protected payloads (see <xref:Microsoft.AspNetCore.DataProtection.ITimeLimitedDataProtector>).</span></span>

* <span data-ttu-id="3374e-168">[Microsoft. AspNetCore. dataprotection. SystemWeb](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.SystemWeb/) pode ser instalado em um aplicativo ASP.NET 4. x existente para redirecionar suas operações de `<machineKey>` para usar a nova pilha de proteção de dados do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="3374e-168">[Microsoft.AspNetCore.DataProtection.SystemWeb](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.SystemWeb/) can be installed into an existing ASP.NET 4.x app to redirect its `<machineKey>` operations to use the new ASP.NET Core data protection stack.</span></span> <span data-ttu-id="3374e-169">Para obter mais informações, consulte <xref:security/data-protection/compatibility/replacing-machinekey>.</span><span class="sxs-lookup"><span data-stu-id="3374e-169">For more information, see <xref:security/data-protection/compatibility/replacing-machinekey>.</span></span>

* <span data-ttu-id="3374e-170">[Microsoft. AspNetCore. Cryptography. Keyderivation](https://www.nuget.org/packages/Microsoft.AspNetCore.Cryptography.KeyDerivation/) fornece uma implementação da rotina de hash de senha do PBKDF2 e pode ser usada por sistemas que devem tratar senhas de usuário com segurança.</span><span class="sxs-lookup"><span data-stu-id="3374e-170">[Microsoft.AspNetCore.Cryptography.KeyDerivation](https://www.nuget.org/packages/Microsoft.AspNetCore.Cryptography.KeyDerivation/) provides an implementation of the PBKDF2 password hashing routine and can be used by systems that must handle user passwords securely.</span></span> <span data-ttu-id="3374e-171">Para obter mais informações, consulte <xref:security/data-protection/consumer-apis/password-hashing>.</span><span class="sxs-lookup"><span data-stu-id="3374e-171">For more information, see <xref:security/data-protection/consumer-apis/password-hashing>.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="3374e-172">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="3374e-172">Additional resources</span></span>

<xref:host-and-deploy/web-farm>
